import xml.etree.ElementTree as ET
import os
from collections import namedtuple
import csv

__permission=dict()

def run(decodepath):
	__readcsv()
	allpermission=__permissionExtract(decodepath)
	return allpermission

def __permissionExtract(decodepath):
    """找到所有应用具有的权限,保存在allpermisison变量中
    """
    allpermission=dict()
    android = '{http://schemas.android.com/apk/res/android}'
    root = ET.parse(decodepath+'/AndroidManifest.xml').getroot()
    for item in root.iter('uses-permission'):
    	p=item.get(android + 'name')
    	if __permission.get(p) is not None:
    		allpermission[p]=__permission[p]
    return allpermission

def __readcsv():
	with open('static/permission.csv') as f:
	#with open(url_for('static',filename = 'permission.csv')) as f:
		f_csv = csv.reader(f)
		for row in f_csv:
			__permission[row[0]]=row[1]

