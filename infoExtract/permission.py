import xml.etree.ElementTree as ET
import csv

__permission = dict()


def run(decode_path):
	all_permission = __permission_extract(decode_path)
	return all_permission


def __permission_extract(decode_path):
	"""找到所有应用具有的权限,保存在all_permisison变量中
	"""
	all_permission = dict()
	android = '{http://schemas.android.com/apk/res/android}'
	root = ET.parse(decode_path + '/AndroidManifest.xml').getroot()
	for item in root.iter('uses-permission'):
		p = item.get(android + 'name')
		if __permission.get(p):
			all_permission[p] = __permission[p]
	return all_permission


def __read_csv():
	with open('static/permission.csv') as f:
		# with open(url_for('static',filename = 'permission.csv')) as f:
		f_csv = csv.reader(f)
		for row in f_csv:
			__permission[row[0]] = row[1]


__read_csv()
