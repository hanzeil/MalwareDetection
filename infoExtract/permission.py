import xml.etree.ElementTree as ET
import csv

__permission_list = dict()
__permission = dict()


def run(decode_path):
	__permission_extract(decode_path)
	return __permission


def __permission_extract(decode_path):
	"""找到所有应用具有的权限,保存在all_permisison变量中
	"""
	android = '{http://schemas.android.com/apk/res/android}'
	root = ET.parse(decode_path + '/AndroidManifest.xml').getroot()
	for item in root.iter('uses-permission'):
		p = item.get(android + 'name')
		if __permission_list.get(p):
			__permission[p] = __permission_list[p]
		else:
			__permission[p] = {'Description': None, 'Threat Level': None, 'Protection Level': None}
	return __permission


def __read_csv():
	with open('featureList/all_permission.csv') as f:
		f_csv = csv.reader(f)
		for row in f_csv:
			__permission_list[row[0]] = {'Description': row[1], 'Threat Level': row[2], 'Protection Level': row[3]}

__read_csv()
