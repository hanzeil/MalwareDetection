var file;
function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object

    // files is a FileList of File objects. List some properties.
    var output = [];
    file=files[0];
    output.push('<li><strong>', escape(file.name), '</strong> (', file.type || 'n/a', ') - ',
              file.size, ' bytes, last modified: ',
              file.lastModifiedDate.toLocaleDateString(), '</li>');
    document.getElementById('file_list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }
document.getElementById('file').addEventListener('change', handleFileSelect, false);
function upload(){
    //progress bar is 0%
    file_type=file.name.substring(file.name.lastIndexOf('.') + 1) ;
    if (file_type!='apk' && file_type!='APK'){
        alert('APK file-type needed')
        return;
    }
    document.getElementById('upload-progress-bar').setAttribute("style","width: 0% ;")
    var fd=new FormData();
    fd.append("file",file)
    xhr=new XMLHttpRequest();
    xhr.onreadystatechange=upload_state_change;
    xhr.open("POST","/")
    xhr.upload.addEventListener("progress", upload_progress, false);
    xhr.send(fd)

}
function upload_state_change() {
    if (xhr.readyState == 4) {// 4 = "loaded"
        if (xhr.status == 200) {// 200 = OK
            console.warn("Uploaded");
            window.location.href = "/report/"+file.name;
        }
        else {
            alert("Problem retrieving XML data");
        }
    }
}
function upload_progress(evt) {
    var percentComplete = Math.round(evt.loaded * 100 / evt.total);
    document.getElementById('upload-progress-bar').setAttribute("style","width: "+percentComplete+'% ;')
}
